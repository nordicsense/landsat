library(RColorBrewer)

cm8517 <- rbind(
    c(446, 331, 0, 27, 0, 0, 913, 927, 34, 1451, 183),
    c(3370, 3923640, 0, 179141, 7944, 17255, 2744, 126009, 1646, 3636, 432),
    c(364, 0, 18440, 19286, 56, 712, 1085, 683, 1340, 7052, 1888),
    c(32814, 70791, 32662, 746433, 0, 109550, 50606, 215766, 152032, 263684, 208385),
    c(118, 48, 0, 0, 6368, 108, 197, 2098, 894, 3877, 545),
    c(12157, 348853, 5062, 311611, 12924, 1988914, 0, 1027647, 1462654, 0, 806333),
    c(5, 544, 250, 2589, 14, 0, 6585, 2878, 200, 0, 584),
    c(1161, 69719, 15448, 17204, 722, 16304, 151015, 1409294, 202270, 190006, 2293),
    c(29943, 328728, 23191, 246819, 20841, 295578, 1944344, 6882779, 2887752, 2864009, 122219),
    c(34104, 300042, 98863, 131825, 849, 0, 0, 2395518, 336415, 4280852, 85088),
    c(21461, 3087, 2839, 191778, 4257, 102295, 44513, 92796, 166789, 578394, 814186)
)

cm8521 <- rbind(
    c(131, 446, 23, 145, 0, 57, 149, 619, 204, 2320, 215),
    c(10301, 3942873, 0, 217437, 746, 4316, 2429, 84925, 1176, 4434, 219),
    c(442, 0, 18559, 25532, 24, 509, 538, 284, 318, 2284, 2418),
    c(7809, 95406, 11324, 636391, 0, 100897, 61949, 174300, 203781, 273643, 320065),
    c(429, 106, 7, 0, 4656, 192, 116, 977, 987, 6285, 489),
    c(23055, 422959, 3995, 84888, 1588, 2560689, 0, 743467, 1047953, 0, 1097218),
    c(189, 810, 77, 2137, 12, 0, 6317, 3081, 487, 0, 543),
    c(7411, 95048, 13960, 15177, 556, 18898, 240879, 947916, 311140, 422918, 2144),
    c(163272, 505109, 18954, 97047, 8086, 188335, 2075548, 3988747, 2195478, 6259958, 163490),
    c(74499, 423170, 39932, 83712, 1369, 0, 0, 985260, 231073, 5772336, 62096),
    c(9792, 7319, 5033, 95492, 279, 60560, 27571, 48191, 96287, 701632, 973978)
)

ct17 <- apply(cm8517,1,function(x) as.integer(100*x/sum(x)))[-1,-1,drop=FALSE]
ct21 <- apply(cm8521,1,function(x) as.integer(100*x/sum(x)))[-1,-1,drop=FALSE]

nms <- c(
    # "Cloud",
    "Clean water",
    "Water with sediments",
    "Non-vegetated / Stone tundra",
    "Burnt areas, mostly new",
    "Dwarf shrub",
    "Wetland",
    "Coniferous (pine, damaged spruce)",
    "Coniferous (spruce)",
    "Deciduous",
    "Tundra vegetation")

cl <- colorRampPalette(brewer.pal(8, "Blues"))(25)

index <- apply(cm8517, 1, sum)[-1]/sum(cm8521)*50
cl85 <- cl[as.integer(index)+1]

pdf("/Volumes/Caffeine/Data/Landsat/results/v11/1985-20xx-contingency.pdf", height=7, width=7)
heatmap(ct17, Rowv=NA,Colv=NA, scale="col", revC=TRUE, labRow=nms, labCol=nms, margins=c(18,18), col=cl, ColSideColors=cl85)
heatmap(ct21, Rowv=NA,Colv=NA, scale="col", revC=TRUE, labRow=nms, labCol=nms, margins=c(18,18), col=cl, ColSideColors=cl85)
dev.off()
